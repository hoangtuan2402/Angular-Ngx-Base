import { ElementRef, Input, Output, EventEmitter, Component } from '@angular/core';
import * as d3 from 'd3';
import 'd3-selection-multi';
// https://medium.com/inside-formstack/friends-dont-let-friends-import-lodash-incorrectly-ac40ca9e3bd5
import merge from 'lodash-es/merge';
export class KnobComponent {
    constructor(el) {
        this.el = el;
        this.valueChange = new EventEmitter();
        // All that need to be instanciated before bindings
        this.element = this.el.nativeElement;
        this.value = 0;
        this.defaultOptions = {
            skin: {
                type: 'simple',
                width: 10,
                color: 'rgba(255,0,0,.5)',
                spaceWidth: 5,
            },
            animate: {
                enabled: true,
                duration: 1000,
                ease: 'bounce',
            },
            size: 200,
            startAngle: 0,
            endAngle: 360,
            unit: '',
            displayInput: true,
            inputFormatter: function (v) {
                return v;
            },
            readOnly: false,
            trackWidth: 50,
            barWidth: 50,
            trackColor: 'rgba(0,0,0,0)',
            barColor: 'rgba(255,0,0,.5)',
            prevBarColor: 'rgba(0,0,0,0)',
            textColor: '#222',
            barCap: 0,
            trackCap: 0,
            fontSize: 'auto',
            fontWeigth: '400',
            fontFamily: 'Arial',
            valueFormat: 'string',
            subText: {
                enabled: false,
                text: '',
                fontFamily: 'Arial',
                fontWeight: 'normal',
                color: 'gray',
                font: 'auto',
                offset: 0,
            },
            bgColor: '',
            bgFull: false,
            scale: {
                enabled: false,
                type: 'lines',
                color: 'gray',
                width: 4,
                quantity: 20,
                height: 10,
                spaceWidth: 15,
            },
            step: 1,
            displayPrevious: false,
            min: 0,
            max: 100,
            dynamicOptions: false,
        };
        this.animations = {
            linear: d3.easeLinear,
            bounce: d3.easeBounce,
        };
    }
    ngOnInit() {
        this.inDrag = false;
        // this.options = (<any>Object).assign(this.defaultOptions, this.options);
        this.options = merge(this.defaultOptions, this.options);
        this.draw();
    }
    ngOnChanges(changes) {
        if (this.defaultOptions != null &&
            changes.options != null &&
            changes.options.currentValue != null &&
            this.value != null) {
            this.options = merge(this.defaultOptions, changes.options.currentValue);
            this.draw();
        }
        if (this.defaultOptions != null &&
            this.options != null &&
            changes.value &&
            changes.value.currentValue != null &&
            changes.value.previousValue != null &&
            changes.value.currentValue !== changes.value.previousValue) {
            this.setValue(changes.value.currentValue);
        }
    }
    /**
     *   Convert from value to radians
     */
    valueToRadians(value, valueEnd, angleEnd = 0, angleStart = 0, valueStart = 0) {
        valueEnd = valueEnd || 100;
        valueStart = valueStart || 0;
        angleEnd = angleEnd || 360;
        angleStart = angleStart || 0;
        return (Math.PI / 180) * (((value - valueStart) * (angleEnd - angleStart)) / (valueEnd - valueStart) + angleStart);
    }
    /**
     *   Convert from radians to value
     */
    radiansToValue(radians, valueEnd, valueStart, angleEnd, angleStart) {
        valueEnd = valueEnd || 100;
        valueStart = valueStart || 0;
        angleEnd = angleEnd || 360;
        angleStart = angleStart || 0;
        return (((180 / Math.PI) * radians - angleStart) * (valueEnd - valueStart)) / (angleEnd - angleStart) + valueStart;
    }
    /**
     *   Create the arc
     */
    createArc(innerRadius, outerRadius, startAngle, endAngle, cornerRadius) {
        const arc = d3
            .arc()
            .innerRadius(innerRadius)
            .outerRadius(outerRadius)
            .startAngle(startAngle)
            .endAngle(endAngle)
            .cornerRadius(cornerRadius);
        return arc;
    }
    /**
     *   Draw the arc
     */
    drawArc(svg, arc, label, style, click, drag) {
        const elem = svg
            .append('path')
            .attr('id', label)
            .attr('d', arc);
        // eslint-disable-next-line guard-for-in
        for (const key in style) {
            elem.style(key, style[key]);
        }
        elem.attr('transform', 'translate(' + this.options.size / 2 + ', ' + this.options.size / 2 + ')');
        if (this.options.readOnly === false) {
            if (click) {
                elem.on('click', click);
            }
            if (drag) {
                elem.call(drag);
            }
        }
        return elem;
    }
    /**
     *   Create the arcs
     */
    createArcs() {
        let outerRadius = parseInt((this.options.size / 2).toString(), 10);
        const startAngle = this.valueToRadians(this.options.startAngle, 360);
        const endAngle = this.valueToRadians(this.options.endAngle, 360);
        if (this.options.scale.enabled) {
            outerRadius -= this.options.scale.width + this.options.scale.spaceWidth;
        }
        let trackInnerRadius = outerRadius - this.options.trackWidth;
        let changeInnerRadius = outerRadius - this.options.barWidth;
        let valueInnerRadius = outerRadius - this.options.barWidth;
        // interactInnerRadius = outerRadius - this.options.barWidth,
        const interactInnerRadius = 1;
        let trackOuterRadius = outerRadius;
        let changeOuterRadius = outerRadius;
        let valueOuterRadius = outerRadius;
        let interactOuterRadius = outerRadius;
        let diff;
        if (this.options.barWidth > this.options.trackWidth) {
            diff = (this.options.barWidth - this.options.trackWidth) / 2;
            trackInnerRadius -= diff;
            trackOuterRadius -= diff;
        }
        else if (this.options.barWidth < this.options.trackWidth) {
            diff = (this.options.trackWidth - this.options.barWidth) / 2;
            changeOuterRadius -= diff;
            valueOuterRadius -= diff;
            changeInnerRadius -= diff;
            valueInnerRadius -= diff;
            // interactInnerRadius = outerRadius - this.options.trackWidth;
        }
        if (this.options.bgColor) {
            if (this.options.bgFull) {
                this.bgArc = this.createArc(0, outerRadius, 0, Math.PI * 2);
            }
            else {
                this.bgArc = this.createArc(0, outerRadius, startAngle, endAngle);
            }
        }
        if (this.options.skin.type === 'tron') {
            trackOuterRadius = trackOuterRadius - this.options.skin.width - this.options.skin.spaceWidth;
            changeOuterRadius = changeOuterRadius - this.options.skin.width - this.options.skin.spaceWidth;
            valueOuterRadius = valueOuterRadius - this.options.skin.width - this.options.skin.spaceWidth;
            interactOuterRadius = interactOuterRadius - this.options.skin.width - this.options.skin.spaceWidth;
            this.hoopArc = this.createArc(outerRadius - this.options.skin.width, outerRadius, startAngle, endAngle);
        }
        this.trackArc = this.createArc(trackInnerRadius, trackOuterRadius, startAngle, endAngle, this.options.trackCap);
        this.changeArc = this.createArc(changeInnerRadius, changeOuterRadius, startAngle, startAngle, this.options.barCap);
        this.valueArc = this.createArc(valueInnerRadius, valueOuterRadius, startAngle, startAngle, this.options.barCap);
        this.interactArc = this.createArc(interactInnerRadius, interactOuterRadius, startAngle, endAngle);
    }
    /**
     *   Draw the arcs
     */
    drawArcs(clickInteraction, dragBehavior) {
        let fontFamily = '';
        const svg = d3
            .select(this.element)
            .append('svg')
            .attr('width', this.options.size)
            .attr('height', this.options.size);
        if (this.options.bgColor) {
            this.drawArc(svg, this.bgArc, 'bgArc', { fill: this.options.bgColor });
        }
        if (this.options.displayInput) {
            let fontSize = this.options.size * 0.2 + 'px';
            if (this.options.fontSize !== 'auto') {
                fontSize = this.options.fontSize + 'px';
            }
            if (this.options.step < 1) {
                this.value = Number(this.value.toFixed(1));
            }
            let v = this.label || this.value;
            if (typeof this.options.inputFormatter === 'function') {
                v = this.options.inputFormatter(v);
            }
            if (this.options.fontFamily !== 'Arial') {
                fontFamily = this.options.fontFamily;
            }
            let fontWeigth = '';
            if (this.options.fontWeigth !== '400') {
                fontWeigth = this.options.fontWeigth;
            }
            svg
                .append('text')
                .attr('id', 'text')
                .attr('class', 'text-value')
                .attr('text-anchor', 'middle')
                .attr('font-size', fontSize)
                .attr('font-weight', fontWeigth)
                .attr('font-family', fontFamily)
                .style('fill', this.options.textColor)
                .text(v + this.options.unit || '')
                .attr('transform', 'translate(' + this.options.size / 2 + ', ' + (this.options.size / 2 + this.options.size * 0.06) + ')');
            if (this.options.subText.enabled) {
                fontSize = this.options.size * 0.07 + 'px';
                if (this.options.subText.font !== 'auto') {
                    fontSize = this.options.subText.font + 'px';
                }
                if (this.options.subText.fontFamily !== 'Arial') {
                    fontFamily = this.options.subText.fontFamily;
                }
                let fontWeight = '';
                if (this.options.subText.fontWeight !== 'normal') {
                    fontWeight = this.options.subText.fontWeight;
                }
                svg
                    .append('text')
                    .attr('class', 'sub-text')
                    .attr('text-anchor', 'middle')
                    .attr('font-size', fontSize)
                    .attr('font-family', fontFamily)
                    .attr('font-weight', fontWeight)
                    .style('fill', this.options.subText.color)
                    .text(this.options.subText.text)
                    .attr('transform', 'translate(' +
                    '' +
                    this.options.size / 2 +
                    ', ' +
                    (this.options.size / 2 + this.options.size * 0.15 + this.options.subText.offset) +
                    ')');
            }
        }
        if (this.options.scale.enabled) {
            let radius;
            let quantity;
            let data;
            let count = 0;
            let angle = 0;
            const startRadians = this.valueToRadians(this.options.min, this.options.max, this.options.endAngle, this.options.startAngle, this.options.min);
            const endRadians = this.valueToRadians(this.options.max, this.options.max, this.options.endAngle, this.options.startAngle, this.options.min);
            let diff = 0;
            if (this.options.startAngle !== 0 || this.options.endAngle !== 360) {
                diff = 1;
            }
            if (this.options.scale.type === 'dots') {
                const width = this.options.scale.width;
                radius = this.options.size / 2 - width;
                quantity = this.options.scale.quantity;
                const offset = radius + this.options.scale.width;
                data = d3.range(quantity).map(function () {
                    angle = count * (endRadians - startRadians) - Math.PI / 2 + startRadians;
                    count = count + 1 / (quantity - diff);
                    return {
                        cx: offset + Math.cos(angle) * radius,
                        cy: offset + Math.sin(angle) * radius,
                        r: width,
                    };
                });
                svg
                    .selectAll('circle')
                    .data(data)
                    .enter()
                    .append('circle')
                    // @ts-ignore
                    .attrs({
                    r: function (d) {
                        return d.r;
                    },
                    cx: function (d) {
                        return d.cx;
                    },
                    cy: function (d) {
                        return d.cy;
                    },
                    fill: this.options.scale.color,
                });
            }
            else if (this.options.scale.type === 'lines') {
                const height = this.options.scale.height;
                radius = this.options.size / 2;
                quantity = this.options.scale.quantity;
                data = d3.range(quantity).map(function () {
                    angle = count * (endRadians - startRadians) - Math.PI / 2 + startRadians;
                    count = count + 1 / (quantity - diff);
                    return {
                        x1: radius + Math.cos(angle) * radius,
                        y1: radius + Math.sin(angle) * radius,
                        x2: radius + Math.cos(angle) * (radius - height),
                        y2: radius + Math.sin(angle) * (radius - height),
                    };
                });
                svg
                    .selectAll('line')
                    .data(data)
                    .enter()
                    .append('line')
                    // @ts-ignore
                    .attrs({
                    x1: function (d) {
                        return d.x1;
                    },
                    y1: function (d) {
                        return d.y1;
                    },
                    x2: function (d) {
                        return d.x2;
                    },
                    y2: function (d) {
                        return d.y2;
                    },
                    'stroke-width': this.options.scale.width,
                    stroke: this.options.scale.color,
                });
            }
        }
        if (this.options.skin.type === 'tron') {
            this.drawArc(svg, this.hoopArc, 'hoopArc', { fill: this.options.skin.color });
        }
        this.drawArc(svg, this.trackArc, 'trackArc', { fill: this.options.trackColor });
        if (this.options.displayPrevious) {
            this.changeElem = this.drawArc(svg, this.changeArc, 'changeArc', { fill: this.options.prevBarColor });
        }
        else {
            this.changeElem = this.drawArc(svg, this.changeArc, 'changeArc', { 'fill-opacity': 0 });
        }
        this.valueElem = this.drawArc(svg, this.valueArc, 'valueArc', { fill: this.options.barColor });
        let cursor = 'pointer';
        if (this.options.readOnly) {
            cursor = 'default';
        }
        this.drawArc(svg, this.interactArc, 'interactArc', { 'fill-opacity': 0, cursor: cursor }, clickInteraction, dragBehavior);
    }
    /**
     *   Draw knob component
     */
    draw() {
        d3.select(this.element)
            .select('svg')
            .remove();
        const that = this;
        that.createArcs();
        const dragBehavior = d3
            .drag()
            .on('drag', dragInteraction)
            .on('end', clickInteraction);
        that.drawArcs(clickInteraction, dragBehavior);
        if (that.options.animate.enabled) {
            // that.valueElem.transition().ease(that.options.animate.ease).duration(that.options.animate.duration).tween('', function () {
            that.valueElem
                .transition()
                .ease(that.animations[that.options.animate.ease])
                .duration(that.options.animate.duration)
                .tween('', function () {
                const i = d3.interpolate(that.valueToRadians(that.options.startAngle, 360), that.valueToRadians(that.value, that.options.max, that.options.endAngle, that.options.startAngle, that.options.min));
                return function (t) {
                    const val = i(t);
                    that.valueElem.attr('d', that.valueArc.endAngle(val));
                    that.changeElem.attr('d', that.changeArc.endAngle(val));
                };
            });
        }
        else {
            that.changeArc.endAngle(this.valueToRadians(this.value, this.options.max, this.options.endAngle, this.options.startAngle, this.options.min));
            that.changeElem.attr('d', that.changeArc);
            that.valueArc.endAngle(this.valueToRadians(this.value, this.options.max, this.options.endAngle, this.options.startAngle, this.options.min));
            that.valueElem.attr('d', that.valueArc);
        }
        function dragInteraction() {
            that.inDrag = true;
            // @ts-ignore
            const x = d3.event.x - that.options.size / 2;
            // @ts-ignore
            const y = d3.event.y - that.options.size / 2;
            interaction(x, y, false);
        }
        function clickInteraction() {
            that.inDrag = false;
            // @ts-ignore
            const coords = d3.mouse(this.parentNode);
            const x = coords[0] - that.options.size / 2;
            const y = coords[1] - that.options.size / 2;
            interaction(x, y, true);
        }
        function interaction(x, y, isFinal) {
            const arc = Math.atan(y / x) / (Math.PI / 180);
            let delta;
            if ((x >= 0 && y <= 0) || (x >= 0 && y >= 0)) {
                delta = 90;
            }
            else {
                delta = 270;
                if (that.options.startAngle < 0) {
                    delta = -90;
                }
            }
            const radians = (delta + arc) * (Math.PI / 180);
            that.value = that.radiansToValue(radians, that.options.max, that.options.min, that.options.endAngle, that.options.startAngle);
            if (that.value >= that.options.min && that.value <= that.options.max) {
                that.value =
                    // eslint-disable-next-line no-bitwise
                    Math.round(~~((that.value < 0 ? -0.5 : 0.5) + that.value / that.options.step) * that.options.step * 100) /
                        100;
                if (that.options.step < 1) {
                    that.value = Number(that.value.toFixed(1));
                }
                that.valueArc.endAngle(that.valueToRadians(that.value, that.options.max, that.options.endAngle, that.options.startAngle, that.options.min));
                that.valueElem.attr('d', that.valueArc);
                if (isFinal) {
                    that.changeArc.endAngle(that.valueToRadians(that.value, that.options.max, that.options.endAngle, that.options.startAngle, that.options.min));
                    that.changeElem.attr('d', that.changeArc);
                }
                if (that.options.displayInput) {
                    let v = that.label || that.value;
                    if (typeof that.options.inputFormatter === 'function') {
                        v = that.options.inputFormatter(v);
                    }
                    d3.select(that.element)
                        .select('#text')
                        .text(v + that.options.unit || '');
                }
            }
            that.valueChange.emit(that.value);
        }
    }
    /**
     *   Set a value
     */
    setValue(newValue) {
        if (!this.inDrag && this.value >= this.options.min && this.value <= this.options.max) {
            const radians = this.valueToRadians(newValue, this.options.max, this.options.endAngle, this.options.startAngle, this.options.min);
            this.value =
                // eslint-disable-next-line no-bitwise
                Math.round(~~((newValue < 0 ? -0.5 : 0.5) + newValue / this.options.step) * this.options.step * 100) / 100;
            if (this.options.step < 1) {
                this.value = Number(this.value.toFixed(1));
            }
            this.changeArc.endAngle(radians);
            d3.select(this.element)
                .select('#changeArc')
                .attr('d', this.changeArc);
            this.valueArc.endAngle(radians);
            d3.select(this.element)
                .select('#valueArc')
                .attr('d', this.valueArc);
            if (this.options.displayInput) {
                let v = this.label || this.value;
                if (typeof this.options.inputFormatter === 'function') {
                    v = this.options.inputFormatter(v);
                }
                d3.select(this.element)
                    .select('#text')
                    .text(v + this.options.unit || '');
            }
        }
    }
}
KnobComponent.decorators = [
    { type: Component, args: [{
                template: '',
                selector: 'ngx-knob'
            },] }
];
KnobComponent.ctorParameters = () => [
    { type: ElementRef }
];
KnobComponent.propDecorators = {
    value: [{ type: Input }],
    label: [{ type: Input }],
    options: [{ type: Input }],
    valueChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia25vYi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9rbm9iL3NyYy9saWIva25vYi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBYSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEcsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDekIsT0FBTyxvQkFBb0IsQ0FBQztBQUM1QixzR0FBc0c7QUFDdEcsT0FBTyxLQUFLLE1BQU0saUJBQWlCLENBQUM7QUFnRXBDLE1BQU0sT0FBTyxhQUFhO0lBdUJ4QixZQUFvQixFQUFjO1FBQWQsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQWRsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFldkMsbURBQW1EO1FBQ25ELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUM7UUFDckMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsY0FBYyxHQUFHO1lBQ3BCLElBQUksRUFBRTtnQkFDSixJQUFJLEVBQUUsUUFBUTtnQkFDZCxLQUFLLEVBQUUsRUFBRTtnQkFDVCxLQUFLLEVBQUUsa0JBQWtCO2dCQUN6QixVQUFVLEVBQUUsQ0FBQzthQUNkO1lBQ0QsT0FBTyxFQUFFO2dCQUNQLE9BQU8sRUFBRSxJQUFJO2dCQUNiLFFBQVEsRUFBRSxJQUFJO2dCQUNkLElBQUksRUFBRSxRQUFRO2FBQ2Y7WUFDRCxJQUFJLEVBQUUsR0FBRztZQUNULFVBQVUsRUFBRSxDQUFDO1lBQ2IsUUFBUSxFQUFFLEdBQUc7WUFDYixJQUFJLEVBQUUsRUFBRTtZQUNSLFlBQVksRUFBRSxJQUFJO1lBQ2xCLGNBQWMsRUFBRSxVQUFTLENBQU07Z0JBQzdCLE9BQU8sQ0FBQyxDQUFD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bkVRLFVBQVU7OztvQkFzRWhCLEtBQUs7b0JBRUwsS0FBSztzQkFFTCxLQUFLOzBCQUVMLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzLCBDb21wb25lbnQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbmltcG9ydCAnZDMtc2VsZWN0aW9uLW11bHRpJztcbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9pbnNpZGUtZm9ybXN0YWNrL2ZyaWVuZHMtZG9udC1sZXQtZnJpZW5kcy1pbXBvcnQtbG9kYXNoLWluY29ycmVjdGx5LWFjNDBjYTllM2JkNVxuaW1wb3J0IG1lcmdlIGZyb20gJ2xvZGFzaC1lcy9tZXJnZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS25vYk9wdGlvbnMge1xuICBza2luPzoge1xuICAgIHR5cGU6IHN0cmluZztcbiAgICB3aWR0aDogbnVtYmVyO1xuICAgIGNvbG9yOiBzdHJpbmc7XG4gICAgc3BhY2VXaWR0aDogbnVtYmVyO1xuICB9O1xuICBhbmltYXRlPzoge1xuICAgIGVuYWJsZWQ6IHRydWU7XG4gICAgZHVyYXRpb246IG51bWJlcjtcbiAgICBlYXNlOiBzdHJpbmc7XG4gIH07XG4gIHNpemU6IG51bWJlcjtcbiAgc3RhcnRBbmdsZTogbnVtYmVyO1xuICBlbmRBbmdsZTogbnVtYmVyO1xuICB1bml0OiBzdHJpbmc7XG4gIGRpc3BsYXlJbnB1dDogdHJ1ZTtcbiAgaW5wdXRGb3JtYXR0ZXI6IGFueTtcbiAgcmVhZE9ubHk6IGJvb2xlYW47XG4gIHRyYWNrV2lkdGg6IG51bWJlcjtcbiAgYmFyV2lkdGg6IG51bWJlcjtcbiAgdHJhY2tDb2xvcjogc3RyaW5nO1xuICBiYXJDb2xvcjogc3RyaW5nO1xuICBwcmV2QmFyQ29sb3I6IHN0cmluZztcbiAgdGV4dENvbG9yOiBzdHJpbmc7XG4gIGJhckNhcDogbnVtYmVyO1xuICB0cmFja0NhcDogbnVtYmVyO1xuICBmb250U2l6ZTogc3RyaW5nO1xuICBmb250V2VpZ3RoOiBzdHJpbmc7XG4gIGZvbnRGYW1pbHk6IHN0cmluZztcbiAgdmFsdWVGb3JtYXQ/OiBzdHJpbmc7XG4gIHN1YlRleHQ6IHtcbiAgICBlbmFibGVkOiBmYWxzZTtcbiAgICB0ZXh0OiAnJztcbiAgICBmb250RmFtaWx5OiBzdHJpbmc7XG4gICAgZm9udFdlaWdodDogc3RyaW5nO1xuICAgIGNvbG9yOiBzdHJpbmc7XG4gICAgZm9udDogc3RyaW5nO1xuICAgIG9mZnNldDogbnVtYmVyO1xuICB9O1xuICBiZ0NvbG9yOiBzdHJpbmc7XG4gIGJnRnVsbDogZmFsc2U7XG4gIHNjYWxlOiB7XG4gICAgZW5hYmxlZDogZmFsc2U7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIGNvbG9yOiBzdHJpbmc7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBxdWFudGl0eTogbnVtYmVyO1xuICAgIGhlaWdodDogbnVtYmVyO1xuICAgIHNwYWNlV2lkdGg6IG51bWJlcjtcbiAgfTtcbiAgc3RlcDogbnVtYmVyO1xuICBkaXNwbGF5UHJldmlvdXM6IGZhbHNlO1xuICBtaW46IG51bWJlcjtcbiAgbWF4OiBudW1iZXI7XG4gIGR5bmFtaWNPcHRpb25zOiBmYWxzZTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHRlbXBsYXRlOiAnJyxcbiAgc2VsZWN0b3I6ICduZ3gta25vYidcbn0pXG5leHBvcnQgY2xhc3MgS25vYkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIEBJbnB1dCgpXG4gIHZhbHVlOiBudW1iZXI7XG4gIEBJbnB1dCgpXG4gIGxhYmVsOiBudW1iZXI7XG4gIEBJbnB1dCgpXG4gIG9wdGlvbnM6IGFueTtcbiAgQE91dHB1dCgpXG4gIHZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgaW5EcmFnOiBCb29sZWFuO1xuICBiZ0FyYzogYW55O1xuICB0cmFja0FyYzogYW55O1xuICBjaGFuZ2VBcmM6IGFueTtcbiAgdmFsdWVBcmM6IGFueTtcbiAgaW50ZXJhY3RBcmM6IGFueTtcbiAgaG9vcEFyYzogYW55O1xuICBjaGFuZ2VFbGVtOiBhbnk7XG4gIHZhbHVlRWxlbTogYW55O1xuICBkZWZhdWx0T3B0aW9uczogS25vYk9wdGlvbnM7XG4gIGFuaW1hdGlvbnM6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmKSB7XG4gICAgLy8gQWxsIHRoYXQgbmVlZCB0byBiZSBpbnN0YW5jaWF0ZWQgYmVmb3JlIGJpbmRpbmdzXG4gICAgdGhpcy5lbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMudmFsdWUgPSAwO1xuICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICBza2luOiB7XG4gICAgICAgIHR5cGU6ICdzaW1wbGUnLFxuICAgICAgICB3aWR0aDogMTAsXG4gICAgICAgIGNvbG9yOiAncmdiYSgyNTUsMCwwLC41KScsXG4gICAgICAgIHNwYWNlV2lkdGg6IDUsXG4gICAgICB9LFxuICAgICAgYW5pbWF0ZToge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAgICAgZWFzZTogJ2JvdW5jZScsXG4gICAgICB9LFxuICAgICAgc2l6ZTogMjAwLFxuICAgICAgc3RhcnRBbmdsZTogMCxcbiAgICAgIGVuZEFuZ2xlOiAzNjAsXG4gICAgICB1bml0OiAnJyxcbiAgICAgIGRpc3BsYXlJbnB1dDogdHJ1ZSxcbiAgICAgIGlucHV0Rm9ybWF0dGVyOiBmdW5jdGlvbih2OiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgICB9LFxuICAgICAgcmVhZE9ubHk6IGZhbHNlLFxuICAgICAgdHJhY2tXaWR0aDogNTAsXG4gICAgICBiYXJXaWR0aDogNTAsXG4gICAgICB0cmFja0NvbG9yOiAncmdiYSgwLDAsMCwwKScsXG4gICAgICBiYXJDb2xvcjogJ3JnYmEoMjU1LDAsMCwuNSknLFxuICAgICAgcHJldkJhckNvbG9yOiAncmdiYSgwLDAsMCwwKScsXG4gICAgICB0ZXh0Q29sb3I6ICcjMjIyJyxcbiAgICAgIGJhckNhcDogMCxcbiAgICAgIHRyYWNrQ2FwOiAwLFxuICAgICAgZm9udFNpemU6ICdhdXRvJyxcbiAgICAgIGZvbnRXZWlndGg6ICc0MDAnLFxuICAgICAgZm9udEZhbWlseTogJ0FyaWFsJyxcbiAgICAgIHZhbHVlRm9ybWF0OiAnc3RyaW5nJyxcbiAgICAgIHN1YlRleHQ6IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHRleHQ6ICcnLFxuICAgICAgICBmb250RmFtaWx5OiAnQXJpYWwnLFxuICAgICAgICBmb250V2VpZ2h0OiAnbm9ybWFsJyxcbiAgICAgICAgY29sb3I6ICdncmF5JyxcbiAgICAgICAgZm9udDogJ2F1dG8nLFxuICAgICAgICBvZmZzZXQ6IDAsXG4gICAgICB9LFxuICAgICAgYmdDb2xvcjogJycsXG4gICAgICBiZ0Z1bGw6IGZhbHNlLFxuICAgICAgc2NhbGU6IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdsaW5lcycsXG4gICAgICAgIGNvbG9yOiAnZ3JheScsXG4gICAgICAgIHdpZHRoOiA0LFxuICAgICAgICBxdWFudGl0eTogMjAsXG4gICAgICAgIGhlaWdodDogMTAsXG4gICAgICAgIHNwYWNlV2lkdGg6IDE1LFxuICAgICAgfSxcbiAgICAgIHN0ZXA6IDEsXG4gICAgICBkaXNwbGF5UHJldmlvdXM6IGZhbHNlLFxuICAgICAgbWluOiAwLFxuICAgICAgbWF4OiAxMDAsXG4gICAgICBkeW5hbWljT3B0aW9uczogZmFsc2UsXG4gICAgfTtcblxuICAgIHRoaXMuYW5pbWF0aW9ucyA9IHtcbiAgICAgIGxpbmVhcjogZDMuZWFzZUxpbmVhcixcbiAgICAgIGJvdW5jZTogZDMuZWFzZUJvdW5jZSxcbiAgICB9O1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5pbkRyYWcgPSBmYWxzZTtcbiAgICAvLyB0aGlzLm9wdGlvbnMgPSAoPGFueT5PYmplY3QpLmFzc2lnbih0aGlzLmRlZmF1bHRPcHRpb25zLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMub3B0aW9ucyA9IG1lcmdlKHRoaXMuZGVmYXVsdE9wdGlvbnMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5kcmF3KCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBhbnkpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmRlZmF1bHRPcHRpb25zICE9IG51bGwgJiZcbiAgICAgIGNoYW5nZXMub3B0aW9ucyAhPSBudWxsICYmXG4gICAgICBjaGFuZ2VzLm9wdGlvbnMuY3VycmVudFZhbHVlICE9IG51bGwgJiZcbiAgICAgIHRoaXMudmFsdWUgIT0gbnVsbFxuICAgICkge1xuICAgICAgdGhpcy5vcHRpb25zID0gbWVyZ2UodGhpcy5kZWZhdWx0T3B0aW9ucywgY2hhbmdlcy5vcHRpb25zLmN1cnJlbnRWYWx1ZSk7XG4gICAgICB0aGlzLmRyYXcoKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLmRlZmF1bHRPcHRpb25zICE9IG51bGwgJiZcbiAgICAgIHRoaXMub3B0aW9ucyAhPSBudWxsICYmXG4gICAgICBjaGFuZ2VzLnZhbHVlICYmXG4gICAgICBjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSAhPSBudWxsICYmXG4gICAgICBjaGFuZ2VzLnZhbHVlLnByZXZpb3VzVmFsdWUgIT0gbnVsbCAmJlxuICAgICAgY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMudmFsdWUucHJldmlvdXNWYWx1ZVxuICAgICkge1xuICAgICAgdGhpcy5zZXRWYWx1ZShjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqICAgQ29udmVydCBmcm9tIHZhbHVlIHRvIHJhZGlhbnNcbiAgICovXG4gIHZhbHVlVG9SYWRpYW5zKFxuICAgIHZhbHVlOiBudW1iZXIsXG4gICAgdmFsdWVFbmQ6IG51bWJlcixcbiAgICBhbmdsZUVuZDogbnVtYmVyID0gMCxcbiAgICBhbmdsZVN0YXJ0OiBudW1iZXIgPSAwLFxuICAgIHZhbHVlU3RhcnQ6IG51bWJlciA9IDAsXG4gICkge1xuICAgIHZhbHVlRW5kID0gdmFsdWVFbmQgfHwgMTAwO1xuICAgIHZhbHVlU3RhcnQgPSB2YWx1ZVN0YXJ0IHx8IDA7XG4gICAgYW5nbGVFbmQgPSBhbmdsZUVuZCB8fCAzNjA7XG4gICAgYW5nbGVTdGFydCA9IGFuZ2xlU3RhcnQgfHwgMDtcbiAgICByZXR1cm4gKE1hdGguUEkgLyAxODApICogKCgodmFsdWUgLSB2YWx1ZVN0YXJ0KSAqIChhbmdsZUVuZCAtIGFuZ2xlU3RhcnQpKSAvICh2YWx1ZUVuZCAtIHZhbHVlU3RhcnQpICsgYW5nbGVTdGFydCk7XG4gIH1cblxuICAvKipcbiAgICogICBDb252ZXJ0IGZyb20gcmFkaWFucyB0byB2YWx1ZVxuICAgKi9cbiAgcmFkaWFuc1RvVmFsdWUocmFkaWFuczogbnVtYmVyLCB2YWx1ZUVuZDogbnVtYmVyLCB2YWx1ZVN0YXJ0OiBudW1iZXIsIGFuZ2xlRW5kOiBudW1iZXIsIGFuZ2xlU3RhcnQ6IG51bWJlcikge1xuICAgIHZhbHVlRW5kID0gdmFsdWVFbmQgfHwgMTAwO1xuICAgIHZhbHVlU3RhcnQgPSB2YWx1ZVN0YXJ0IHx8IDA7XG4gICAgYW5nbGVFbmQgPSBhbmdsZUVuZCB8fCAzNjA7XG4gICAgYW5nbGVTdGFydCA9IGFuZ2xlU3RhcnQgfHwgMDtcbiAgICByZXR1cm4gKCgoMTgwIC8gTWF0aC5QSSkgKiByYWRpYW5zIC0gYW5nbGVTdGFydCkgKiAodmFsdWVFbmQgLSB2YWx1ZVN0YXJ0KSkgLyAoYW5nbGVFbmQgLSBhbmdsZVN0YXJ0KSArIHZhbHVlU3RhcnQ7XG4gIH1cblxuICAvKipcbiAgICogICBDcmVhdGUgdGhlIGFyY1xuICAgKi9cbiAgY3JlYXRlQXJjKFxuICAgIGlubmVyUmFkaXVzOiBudW1iZXIsXG4gICAgb3V0ZXJSYWRpdXM6IG51bWJlcixcbiAgICBzdGFydEFuZ2xlPzogbnVtYmVyLFxuICAgIGVuZEFuZ2xlPzogbnVtYmVyLFxuICAgIGNvcm5lclJhZGl1cz86IG51bWJlcixcbiAgKTogYW55IHtcbiAgICBjb25zdCBhcmMgPSBkM1xuICAgICAgLmFyYygpXG4gICAgICAuaW5uZXJSYWRpdXMoaW5uZXJSYWRpdXMpXG4gICAgICAub3V0ZXJSYWRpdXMob3V0ZXJSYWRpdXMpXG4gICAgICAuc3RhcnRBbmdsZShzdGFydEFuZ2xlKVxuICAgICAgLmVuZEFuZ2xlKGVuZEFuZ2xlKVxuICAgICAgLmNvcm5lclJhZGl1cyhjb3JuZXJSYWRpdXMpO1xuICAgIHJldHVybiBhcmM7XG4gIH1cblxuICAvKipcbiAgICogICBEcmF3IHRoZSBhcmNcbiAgICovXG4gIGRyYXdBcmMoc3ZnOiBhbnksIGFyYzogYW55LCBsYWJlbDogc3RyaW5nLCBzdHlsZTogYW55LCBjbGljaz86IGFueSwgZHJhZz86IGFueSkge1xuICAgIGNvbnN0IGVsZW0gPSBzdmdcbiAgICAgIC5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLmF0dHIoJ2lkJywgbGFiZWwpXG4gICAgICAuYXR0cignZCcsIGFyYyk7XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ3VhcmQtZm9yLWluXG4gICAgZm9yIChjb25zdCBrZXkgaW4gc3R5bGUpIHtcbiAgICAgIGVsZW0uc3R5bGUoa2V5LCBzdHlsZVtrZXldKTtcbiAgICB9XG5cbiAgICBlbGVtLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHRoaXMub3B0aW9ucy5zaXplIC8gMiArICcsICcgKyB0aGlzLm9wdGlvbnMuc2l6ZSAvIDIgKyAnKScpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5yZWFkT25seSA9PT0gZmFsc2UpIHtcbiAgICAgIGlmIChjbGljaykge1xuICAgICAgICBlbGVtLm9uKCdjbGljaycsIGNsaWNrKTtcbiAgICAgIH1cbiAgICAgIGlmIChkcmFnKSB7XG4gICAgICAgIGVsZW0uY2FsbChkcmFnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVsZW07XG4gIH1cblxuICAvKipcbiAgICogICBDcmVhdGUgdGhlIGFyY3NcbiAgICovXG4gIGNyZWF0ZUFyY3MoKSB7XG4gICAgbGV0IG91dGVyUmFkaXVzID0gcGFyc2VJbnQoKHRoaXMub3B0aW9ucy5zaXplIC8gMikudG9TdHJpbmcoKSwgMTApO1xuICAgIGNvbnN0IHN0YXJ0QW5nbGUgPSB0aGlzLnZhbHVlVG9SYWRpYW5zKHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlLCAzNjApO1xuICAgIGNvbnN0IGVuZEFuZ2xlID0gdGhpcy52YWx1ZVRvUmFkaWFucyh0aGlzLm9wdGlvbnMuZW5kQW5nbGUsIDM2MCk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5zY2FsZS5lbmFibGVkKSB7XG4gICAgICBvdXRlclJhZGl1cyAtPSB0aGlzLm9wdGlvbnMuc2NhbGUud2lkdGggKyB0aGlzLm9wdGlvbnMuc2NhbGUuc3BhY2VXaWR0aDtcbiAgICB9XG4gICAgbGV0IHRyYWNrSW5uZXJSYWRpdXMgPSBvdXRlclJhZGl1cyAtIHRoaXMub3B0aW9ucy50cmFja1dpZHRoO1xuICAgIGxldCBjaGFuZ2VJbm5lclJhZGl1cyA9IG91dGVyUmFkaXVzIC0gdGhpcy5vcHRpb25zLmJhcldpZHRoO1xuICAgIGxldCB2YWx1ZUlubmVyUmFkaXVzID0gb3V0ZXJSYWRpdXMgLSB0aGlzLm9wdGlvbnMuYmFyV2lkdGg7XG4gICAgLy8gaW50ZXJhY3RJbm5lclJhZGl1cyA9IG91dGVyUmFkaXVzIC0gdGhpcy5vcHRpb25zLmJhcldpZHRoLFxuICAgIGNvbnN0IGludGVyYWN0SW5uZXJSYWRpdXMgPSAxO1xuXG4gICAgbGV0IHRyYWNrT3V0ZXJSYWRpdXMgPSBvdXRlclJhZGl1cztcbiAgICBsZXQgY2hhbmdlT3V0ZXJSYWRpdXMgPSBvdXRlclJhZGl1cztcbiAgICBsZXQgdmFsdWVPdXRlclJhZGl1cyA9IG91dGVyUmFkaXVzO1xuICAgIGxldCBpbnRlcmFjdE91dGVyUmFkaXVzID0gb3V0ZXJSYWRpdXM7XG4gICAgbGV0IGRpZmY7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmJhcldpZHRoID4gdGhpcy5vcHRpb25zLnRyYWNrV2lkdGgpIHtcbiAgICAgIGRpZmYgPSAodGhpcy5vcHRpb25zLmJhcldpZHRoIC0gdGhpcy5vcHRpb25zLnRyYWNrV2lkdGgpIC8gMjtcbiAgICAgIHRyYWNrSW5uZXJSYWRpdXMgLT0gZGlmZjtcbiAgICAgIHRyYWNrT3V0ZXJSYWRpdXMgLT0gZGlmZjtcbiAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5iYXJXaWR0aCA8IHRoaXMub3B0aW9ucy50cmFja1dpZHRoKSB7XG4gICAgICBkaWZmID0gKHRoaXMub3B0aW9ucy50cmFja1dpZHRoIC0gdGhpcy5vcHRpb25zLmJhcldpZHRoKSAvIDI7XG4gICAgICBjaGFuZ2VPdXRlclJhZGl1cyAtPSBkaWZmO1xuICAgICAgdmFsdWVPdXRlclJhZGl1cyAtPSBkaWZmO1xuICAgICAgY2hhbmdlSW5uZXJSYWRpdXMgLT0gZGlmZjtcbiAgICAgIHZhbHVlSW5uZXJSYWRpdXMgLT0gZGlmZjtcbiAgICAgIC8vIGludGVyYWN0SW5uZXJSYWRpdXMgPSBvdXRlclJhZGl1cyAtIHRoaXMub3B0aW9ucy50cmFja1dpZHRoO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zLmJnQ29sb3IpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYmdGdWxsKSB7XG4gICAgICAgIHRoaXMuYmdBcmMgPSB0aGlzLmNyZWF0ZUFyYygwLCBvdXRlclJhZGl1cywgMCwgTWF0aC5QSSAqIDIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5iZ0FyYyA9IHRoaXMuY3JlYXRlQXJjKDAsIG91dGVyUmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLm9wdGlvbnMuc2tpbi50eXBlID09PSAndHJvbicpIHtcbiAgICAgIHRyYWNrT3V0ZXJSYWRpdXMgPSB0cmFja091dGVyUmFkaXVzIC0gdGhpcy5vcHRpb25zLnNraW4ud2lkdGggLSB0aGlzLm9wdGlvbnMuc2tpbi5zcGFjZVdpZHRoO1xuICAgICAgY2hhbmdlT3V0ZXJSYWRpdXMgPSBjaGFuZ2VPdXRlclJhZGl1cyAtIHRoaXMub3B0aW9ucy5za2luLndpZHRoIC0gdGhpcy5vcHRpb25zLnNraW4uc3BhY2VXaWR0aDtcbiAgICAgIHZhbHVlT3V0ZXJSYWRpdXMgPSB2YWx1ZU91dGVyUmFkaXVzIC0gdGhpcy5vcHRpb25zLnNraW4ud2lkdGggLSB0aGlzLm9wdGlvbnMuc2tpbi5zcGFjZVdpZHRoO1xuICAgICAgaW50ZXJhY3RPdXRlclJhZGl1cyA9IGludGVyYWN0T3V0ZXJSYWRpdXMgLSB0aGlzLm9wdGlvbnMuc2tpbi53aWR0aCAtIHRoaXMub3B0aW9ucy5za2luLnNwYWNlV2lkdGg7XG4gICAgICB0aGlzLmhvb3BBcmMgPSB0aGlzLmNyZWF0ZUFyYyhvdXRlclJhZGl1cyAtIHRoaXMub3B0aW9ucy5za2luLndpZHRoLCBvdXRlclJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUpO1xuICAgIH1cblxuICAgIHRoaXMudHJhY2tBcmMgPSB0aGlzLmNyZWF0ZUFyYyh0cmFja0lubmVyUmFkaXVzLCB0cmFja091dGVyUmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgdGhpcy5vcHRpb25zLnRyYWNrQ2FwKTtcbiAgICB0aGlzLmNoYW5nZUFyYyA9IHRoaXMuY3JlYXRlQXJjKGNoYW5nZUlubmVyUmFkaXVzLCBjaGFuZ2VPdXRlclJhZGl1cywgc3RhcnRBbmdsZSwgc3RhcnRBbmdsZSwgdGhpcy5vcHRpb25zLmJhckNhcCk7XG4gICAgdGhpcy52YWx1ZUFyYyA9IHRoaXMuY3JlYXRlQXJjKHZhbHVlSW5uZXJSYWRpdXMsIHZhbHVlT3V0ZXJSYWRpdXMsIHN0YXJ0QW5nbGUsIHN0YXJ0QW5nbGUsIHRoaXMub3B0aW9ucy5iYXJDYXApO1xuICAgIHRoaXMuaW50ZXJhY3RBcmMgPSB0aGlzLmNyZWF0ZUFyYyhpbnRlcmFjdElubmVyUmFkaXVzLCBpbnRlcmFjdE91dGVyUmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSk7XG4gIH1cblxuICAvKipcbiAgICogICBEcmF3IHRoZSBhcmNzXG4gICAqL1xuICBkcmF3QXJjcyhjbGlja0ludGVyYWN0aW9uOiBhbnksIGRyYWdCZWhhdmlvcjogYW55KSB7XG4gICAgbGV0IGZvbnRGYW1pbHkgPSAnJztcbiAgICBjb25zdCBzdmcgPSBkM1xuICAgICAgLnNlbGVjdCh0aGlzLmVsZW1lbnQpXG4gICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgdGhpcy5vcHRpb25zLnNpemUpXG4gICAgICAuYXR0cignaGVpZ2h0JywgdGhpcy5vcHRpb25zLnNpemUpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5iZ0NvbG9yKSB7XG4gICAgICB0aGlzLmRyYXdBcmMoc3ZnLCB0aGlzLmJnQXJjLCAnYmdBcmMnLCB7IGZpbGw6IHRoaXMub3B0aW9ucy5iZ0NvbG9yIH0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzcGxheUlucHV0KSB7XG4gICAgICBsZXQgZm9udFNpemU6IHN0cmluZyA9IHRoaXMub3B0aW9ucy5zaXplICogMC4yICsgJ3B4JztcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9udFNpemUgIT09ICdhdXRvJykge1xuICAgICAgICBmb250U2l6ZSA9IHRoaXMub3B0aW9ucy5mb250U2l6ZSArICdweCc7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnN0ZXAgPCAxKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBOdW1iZXIodGhpcy52YWx1ZS50b0ZpeGVkKDEpKTtcbiAgICAgIH1cbiAgICAgIGxldCB2ID0gdGhpcy5sYWJlbCB8fCB0aGlzLnZhbHVlO1xuICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuaW5wdXRGb3JtYXR0ZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdiA9IHRoaXMub3B0aW9ucy5pbnB1dEZvcm1hdHRlcih2KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5mb250RmFtaWx5ICE9PSAnQXJpYWwnKSB7XG4gICAgICAgIGZvbnRGYW1pbHkgPSB0aGlzLm9wdGlvbnMuZm9udEZhbWlseTtcbiAgICAgIH1cbiAgICAgIGxldCBmb250V2VpZ3RoID0gJyc7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmZvbnRXZWlndGggIT09ICc0MDAnKSB7XG4gICAgICAgIGZvbnRXZWlndGggPSB0aGlzLm9wdGlvbnMuZm9udFdlaWd0aDtcbiAgICAgIH1cbiAgICAgIHN2Z1xuICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgLmF0dHIoJ2lkJywgJ3RleHQnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAndGV4dC12YWx1ZScpXG4gICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAuYXR0cignZm9udC1zaXplJywgZm9udFNpemUpXG4gICAgICAgIC5hdHRyKCdmb250LXdlaWdodCcsIGZvbnRXZWlndGgpXG4gICAgICAgIC5hdHRyKCdmb250LWZhbWlseScsIGZvbnRGYW1pbHkpXG4gICAgICAgIC5zdHlsZSgnZmlsbCcsIHRoaXMub3B0aW9ucy50ZXh0Q29sb3IpXG4gICAgICAgIC50ZXh0KHYgKyB0aGlzLm9wdGlvbnMudW5pdCB8fCAnJylcbiAgICAgICAgLmF0dHIoXG4gICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgJ3RyYW5zbGF0ZSgnICsgdGhpcy5vcHRpb25zLnNpemUgLyAyICsgJywgJyArICh0aGlzLm9wdGlvbnMuc2l6ZSAvIDIgKyB0aGlzLm9wdGlvbnMuc2l6ZSAqIDAuMDYpICsgJyknLFxuICAgICAgICApO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnN1YlRleHQuZW5hYmxlZCkge1xuICAgICAgICBmb250U2l6ZSA9IHRoaXMub3B0aW9ucy5zaXplICogMC4wNyArICdweCc7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3ViVGV4dC5mb250ICE9PSAnYXV0bycpIHtcbiAgICAgICAgICBmb250U2l6ZSA9IHRoaXMub3B0aW9ucy5zdWJUZXh0LmZvbnQgKyAncHgnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdWJUZXh0LmZvbnRGYW1pbHkgIT09ICdBcmlhbCcpIHtcbiAgICAgICAgICBmb250RmFtaWx5ID0gdGhpcy5vcHRpb25zLnN1YlRleHQuZm9udEZhbWlseTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZm9udFdlaWdodCA9ICcnO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN1YlRleHQuZm9udFdlaWdodCAhPT0gJ25vcm1hbCcpIHtcbiAgICAgICAgICBmb250V2VpZ2h0ID0gdGhpcy5vcHRpb25zLnN1YlRleHQuZm9udFdlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBzdmdcbiAgICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3ViLXRleHQnKVxuICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgIC5hdHRyKCdmb250LXNpemUnLCBmb250U2l6ZSlcbiAgICAgICAgICAuYXR0cignZm9udC1mYW1pbHknLCBmb250RmFtaWx5KVxuICAgICAgICAgIC5hdHRyKCdmb250LXdlaWdodCcsIGZvbnRXZWlnaHQpXG4gICAgICAgICAgLnN0eWxlKCdmaWxsJywgdGhpcy5vcHRpb25zLnN1YlRleHQuY29sb3IpXG4gICAgICAgICAgLnRleHQodGhpcy5vcHRpb25zLnN1YlRleHQudGV4dClcbiAgICAgICAgICAuYXR0cihcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAgICAgJ3RyYW5zbGF0ZSgnICtcbiAgICAgICAgICAgICcnICtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zaXplIC8gMiArXG4gICAgICAgICAgICAnLCAnICtcbiAgICAgICAgICAgICh0aGlzLm9wdGlvbnMuc2l6ZSAvIDIgKyB0aGlzLm9wdGlvbnMuc2l6ZSAqIDAuMTUgKyB0aGlzLm9wdGlvbnMuc3ViVGV4dC5vZmZzZXQpICtcbiAgICAgICAgICAgICcpJyxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zLnNjYWxlLmVuYWJsZWQpIHtcbiAgICAgIGxldCByYWRpdXM6IG51bWJlcjtcbiAgICAgIGxldCBxdWFudGl0eTogbnVtYmVyO1xuICAgICAgbGV0IGRhdGE7XG4gICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgbGV0IGFuZ2xlID0gMDtcbiAgICAgIGNvbnN0IHN0YXJ0UmFkaWFucyA9IHRoaXMudmFsdWVUb1JhZGlhbnMoXG4gICAgICAgIHRoaXMub3B0aW9ucy5taW4sXG4gICAgICAgIHRoaXMub3B0aW9ucy5tYXgsXG4gICAgICAgIHRoaXMub3B0aW9ucy5lbmRBbmdsZSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgIHRoaXMub3B0aW9ucy5taW4sXG4gICAgICApO1xuICAgICAgY29uc3QgZW5kUmFkaWFucyA9IHRoaXMudmFsdWVUb1JhZGlhbnMoXG4gICAgICAgIHRoaXMub3B0aW9ucy5tYXgsXG4gICAgICAgIHRoaXMub3B0aW9ucy5tYXgsXG4gICAgICAgIHRoaXMub3B0aW9ucy5lbmRBbmdsZSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgIHRoaXMub3B0aW9ucy5taW4sXG4gICAgICApO1xuICAgICAgbGV0IGRpZmYgPSAwO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlICE9PSAwIHx8IHRoaXMub3B0aW9ucy5lbmRBbmdsZSAhPT0gMzYwKSB7XG4gICAgICAgIGRpZmYgPSAxO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zY2FsZS50eXBlID09PSAnZG90cycpIHtcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLm9wdGlvbnMuc2NhbGUud2lkdGg7XG4gICAgICAgIHJhZGl1cyA9IHRoaXMub3B0aW9ucy5zaXplIC8gMiAtIHdpZHRoO1xuICAgICAgICBxdWFudGl0eSA9IHRoaXMub3B0aW9ucy5zY2FsZS5xdWFudGl0eTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0OiBudW1iZXIgPSByYWRpdXMgKyB0aGlzLm9wdGlvbnMuc2NhbGUud2lkdGg7XG4gICAgICAgIGRhdGEgPSBkMy5yYW5nZShxdWFudGl0eSkubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGFuZ2xlID0gY291bnQgKiAoZW5kUmFkaWFucyAtIHN0YXJ0UmFkaWFucykgLSBNYXRoLlBJIC8gMiArIHN0YXJ0UmFkaWFucztcbiAgICAgICAgICBjb3VudCA9IGNvdW50ICsgMSAvIChxdWFudGl0eSAtIGRpZmYpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjeDogb2Zmc2V0ICsgTWF0aC5jb3MoYW5nbGUpICogcmFkaXVzLFxuICAgICAgICAgICAgY3k6IG9mZnNldCArIE1hdGguc2luKGFuZ2xlKSAqIHJhZGl1cyxcbiAgICAgICAgICAgIHI6IHdpZHRoLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBzdmdcbiAgICAgICAgICAuc2VsZWN0QWxsKCdjaXJjbGUnKVxuICAgICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAuYXR0cnMoe1xuICAgICAgICAgICAgcjogZnVuY3Rpb24oZDogeyByOiBhbnkgfSkge1xuICAgICAgICAgICAgICByZXR1cm4gZC5yO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGN4OiBmdW5jdGlvbihkOiB7IGN4OiBudW1iZXIgfSkge1xuICAgICAgICAgICAgICByZXR1cm4gZC5jeDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjeTogZnVuY3Rpb24oZDogeyBjeTogbnVtYmVyIH0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQuY3k7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsbDogdGhpcy5vcHRpb25zLnNjYWxlLmNvbG9yLFxuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc2NhbGUudHlwZSA9PT0gJ2xpbmVzJykge1xuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLm9wdGlvbnMuc2NhbGUuaGVpZ2h0O1xuICAgICAgICByYWRpdXMgPSB0aGlzLm9wdGlvbnMuc2l6ZSAvIDI7XG4gICAgICAgIHF1YW50aXR5ID0gdGhpcy5vcHRpb25zLnNjYWxlLnF1YW50aXR5O1xuICAgICAgICBkYXRhID0gZDMucmFuZ2UocXVhbnRpdHkpLm1hcChmdW5jdGlvbigpIHtcbiAgICAgICAgICBhbmdsZSA9IGNvdW50ICogKGVuZFJhZGlhbnMgLSBzdGFydFJhZGlhbnMpIC0gTWF0aC5QSSAvIDIgKyBzdGFydFJhZGlhbnM7XG4gICAgICAgICAgY291bnQgPSBjb3VudCArIDEgLyAocXVhbnRpdHkgLSBkaWZmKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDE6IHJhZGl1cyArIE1hdGguY29zKGFuZ2xlKSAqIHJhZGl1cyxcbiAgICAgICAgICAgIHkxOiByYWRpdXMgKyBNYXRoLnNpbihhbmdsZSkgKiByYWRpdXMsXG4gICAgICAgICAgICB4MjogcmFkaXVzICsgTWF0aC5jb3MoYW5nbGUpICogKHJhZGl1cyAtIGhlaWdodCksXG4gICAgICAgICAgICB5MjogcmFkaXVzICsgTWF0aC5zaW4oYW5nbGUpICogKHJhZGl1cyAtIGhlaWdodCksXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc3ZnXG4gICAgICAgICAgLnNlbGVjdEFsbCgnbGluZScpXG4gICAgICAgICAgLmRhdGEoZGF0YSlcbiAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAuYXR0cnMoe1xuICAgICAgICAgICAgeDE6IGZ1bmN0aW9uKGQ6IHsgeDE6IG51bWJlciB9KSB7XG4gICAgICAgICAgICAgIHJldHVybiBkLngxO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHkxOiBmdW5jdGlvbihkOiB7IHkxOiBudW1iZXIgfSkge1xuICAgICAgICAgICAgICByZXR1cm4gZC55MTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4MjogZnVuY3Rpb24oZDogeyB4MjogbnVtYmVyIH0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQueDI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeTI6IGZ1bmN0aW9uKGQ6IHsgeTI6IG51bWJlciB9KSB7XG4gICAgICAgICAgICAgIHJldHVybiBkLnkyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdzdHJva2Utd2lkdGgnOiB0aGlzLm9wdGlvbnMuc2NhbGUud2lkdGgsXG4gICAgICAgICAgICBzdHJva2U6IHRoaXMub3B0aW9ucy5zY2FsZS5jb2xvcixcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9ucy5za2luLnR5cGUgPT09ICd0cm9uJykge1xuICAgICAgdGhpcy5kcmF3QXJjKHN2ZywgdGhpcy5ob29wQXJjLCAnaG9vcEFyYycsIHsgZmlsbDogdGhpcy5vcHRpb25zLnNraW4uY29sb3IgfSk7XG4gICAgfVxuICAgIHRoaXMuZHJhd0FyYyhzdmcsIHRoaXMudHJhY2tBcmMsICd0cmFja0FyYycsIHsgZmlsbDogdGhpcy5vcHRpb25zLnRyYWNrQ29sb3IgfSk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5kaXNwbGF5UHJldmlvdXMpIHtcbiAgICAgIHRoaXMuY2hhbmdlRWxlbSA9IHRoaXMuZHJhd0FyYyhzdmcsIHRoaXMuY2hhbmdlQXJjLCAnY2hhbmdlQXJjJywgeyBmaWxsOiB0aGlzLm9wdGlvbnMucHJldkJhckNvbG9yIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoYW5nZUVsZW0gPSB0aGlzLmRyYXdBcmMoc3ZnLCB0aGlzLmNoYW5nZUFyYywgJ2NoYW5nZUFyYycsIHsgJ2ZpbGwtb3BhY2l0eSc6IDAgfSk7XG4gICAgfVxuICAgIHRoaXMudmFsdWVFbGVtID0gdGhpcy5kcmF3QXJjKHN2ZywgdGhpcy52YWx1ZUFyYywgJ3ZhbHVlQXJjJywgeyBmaWxsOiB0aGlzLm9wdGlvbnMuYmFyQ29sb3IgfSk7XG4gICAgbGV0IGN1cnNvciA9ICdwb2ludGVyJztcbiAgICBpZiAodGhpcy5vcHRpb25zLnJlYWRPbmx5KSB7XG4gICAgICBjdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgfVxuICAgIHRoaXMuZHJhd0FyYyhcbiAgICAgIHN2ZyxcbiAgICAgIHRoaXMuaW50ZXJhY3RBcmMsXG4gICAgICAnaW50ZXJhY3RBcmMnLFxuICAgICAgeyAnZmlsbC1vcGFjaXR5JzogMCwgY3Vyc29yOiBjdXJzb3IgfSxcbiAgICAgIGNsaWNrSW50ZXJhY3Rpb24sXG4gICAgICBkcmFnQmVoYXZpb3IsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAgIERyYXcga25vYiBjb21wb25lbnRcbiAgICovXG4gIGRyYXcoKSB7XG4gICAgZDMuc2VsZWN0KHRoaXMuZWxlbWVudClcbiAgICAgIC5zZWxlY3QoJ3N2ZycpXG4gICAgICAucmVtb3ZlKCk7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG5cbiAgICB0aGF0LmNyZWF0ZUFyY3MoKTtcblxuICAgIGNvbnN0IGRyYWdCZWhhdmlvciA9IGQzXG4gICAgICAuZHJhZygpXG4gICAgICAub24oJ2RyYWcnLCBkcmFnSW50ZXJhY3Rpb24pXG4gICAgICAub24oJ2VuZCcsIGNsaWNrSW50ZXJhY3Rpb24pO1xuXG4gICAgdGhhdC5kcmF3QXJjcyhjbGlja0ludGVyYWN0aW9uLCBkcmFnQmVoYXZpb3IpO1xuXG4gICAgaWYgKHRoYXQub3B0aW9ucy5hbmltYXRlLmVuYWJsZWQpIHtcbiAgICAgIC8vIHRoYXQudmFsdWVFbGVtLnRyYW5zaXRpb24oKS5lYXNlKHRoYXQub3B0aW9ucy5hbmltYXRlLmVhc2UpLmR1cmF0aW9uKHRoYXQub3B0aW9ucy5hbmltYXRlLmR1cmF0aW9uKS50d2VlbignJywgZnVuY3Rpb24gKCkge1xuICAgICAgdGhhdC52YWx1ZUVsZW1cbiAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAuZWFzZSh0aGF0LmFuaW1hdGlvbnNbdGhhdC5vcHRpb25zLmFuaW1hdGUuZWFzZV0pXG4gICAgICAgIC5kdXJhdGlvbih0aGF0Lm9wdGlvbnMuYW5pbWF0ZS5kdXJhdGlvbilcbiAgICAgICAgLnR3ZWVuKCcnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zdCBpID0gZDMuaW50ZXJwb2xhdGUoXG4gICAgICAgICAgICB0aGF0LnZhbHVlVG9SYWRpYW5zKHRoYXQub3B0aW9ucy5zdGFydEFuZ2xlLCAzNjApLFxuICAgICAgICAgICAgdGhhdC52YWx1ZVRvUmFkaWFucyhcbiAgICAgICAgICAgICAgdGhhdC52YWx1ZSxcbiAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLm1heCxcbiAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLmVuZEFuZ2xlLFxuICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMuc3RhcnRBbmdsZSxcbiAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLm1pbixcbiAgICAgICAgICAgICksXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDogYW55KSB7XG4gICAgICAgICAgICBjb25zdCB2YWwgPSBpKHQpO1xuICAgICAgICAgICAgdGhhdC52YWx1ZUVsZW0uYXR0cignZCcsIHRoYXQudmFsdWVBcmMuZW5kQW5nbGUodmFsKSk7XG4gICAgICAgICAgICB0aGF0LmNoYW5nZUVsZW0uYXR0cignZCcsIHRoYXQuY2hhbmdlQXJjLmVuZEFuZ2xlKHZhbCkpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGF0LmNoYW5nZUFyYy5lbmRBbmdsZShcbiAgICAgICAgdGhpcy52YWx1ZVRvUmFkaWFucyhcbiAgICAgICAgICB0aGlzLnZhbHVlLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5tYXgsXG4gICAgICAgICAgdGhpcy5vcHRpb25zLmVuZEFuZ2xlLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5taW4sXG4gICAgICAgICksXG4gICAgICApO1xuICAgICAgdGhhdC5jaGFuZ2VFbGVtLmF0dHIoJ2QnLCB0aGF0LmNoYW5nZUFyYyk7XG4gICAgICB0aGF0LnZhbHVlQXJjLmVuZEFuZ2xlKFxuICAgICAgICB0aGlzLnZhbHVlVG9SYWRpYW5zKFxuICAgICAgICAgIHRoaXMudmFsdWUsXG4gICAgICAgICAgdGhpcy5vcHRpb25zLm1heCxcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuZW5kQW5nbGUsXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgICAgdGhpcy5vcHRpb25zLm1pbixcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgICB0aGF0LnZhbHVlRWxlbS5hdHRyKCdkJywgdGhhdC52YWx1ZUFyYyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZHJhZ0ludGVyYWN0aW9uKCkge1xuICAgICAgdGhhdC5pbkRyYWcgPSB0cnVlO1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY29uc3QgeCA9IGQzLmV2ZW50LnggLSB0aGF0Lm9wdGlvbnMuc2l6ZSAvIDI7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBjb25zdCB5ID0gZDMuZXZlbnQueSAtIHRoYXQub3B0aW9ucy5zaXplIC8gMjtcbiAgICAgIGludGVyYWN0aW9uKHgsIHksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGlja0ludGVyYWN0aW9uKCkge1xuICAgICAgdGhhdC5pbkRyYWcgPSBmYWxzZTtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGQzLm1vdXNlKHRoaXMucGFyZW50Tm9kZSk7XG4gICAgICBjb25zdCB4ID0gY29vcmRzWzBdIC0gdGhhdC5vcHRpb25zLnNpemUgLyAyO1xuICAgICAgY29uc3QgeSA9IGNvb3Jkc1sxXSAtIHRoYXQub3B0aW9ucy5zaXplIC8gMjtcbiAgICAgIGludGVyYWN0aW9uKHgsIHksIHRydWUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGludGVyYWN0aW9uKHg6IGFueSwgeTogYW55LCBpc0ZpbmFsOiBhbnkpIHtcbiAgICAgIGNvbnN0IGFyYyA9IE1hdGguYXRhbih5IC8geCkgLyAoTWF0aC5QSSAvIDE4MCk7XG4gICAgICBsZXQgZGVsdGE7XG5cbiAgICAgIGlmICgoeCA+PSAwICYmIHkgPD0gMCkgfHwgKHggPj0gMCAmJiB5ID49IDApKSB7XG4gICAgICAgIGRlbHRhID0gOTA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWx0YSA9IDI3MDtcbiAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5zdGFydEFuZ2xlIDwgMCkge1xuICAgICAgICAgIGRlbHRhID0gLTkwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJhZGlhbnMgPSAoZGVsdGEgKyBhcmMpICogKE1hdGguUEkgLyAxODApO1xuICAgICAgdGhhdC52YWx1ZSA9IHRoYXQucmFkaWFuc1RvVmFsdWUoXG4gICAgICAgIHJhZGlhbnMsXG4gICAgICAgIHRoYXQub3B0aW9ucy5tYXgsXG4gICAgICAgIHRoYXQub3B0aW9ucy5taW4sXG4gICAgICAgIHRoYXQub3B0aW9ucy5lbmRBbmdsZSxcbiAgICAgICAgdGhhdC5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICApO1xuICAgICAgaWYgKHRoYXQudmFsdWUgPj0gdGhhdC5vcHRpb25zLm1pbiAmJiB0aGF0LnZhbHVlIDw9IHRoYXQub3B0aW9ucy5tYXgpIHtcbiAgICAgICAgdGhhdC52YWx1ZSA9XG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgICAgICBNYXRoLnJvdW5kKH5+KCh0aGF0LnZhbHVlIDwgMCA/IC0wLjUgOiAwLjUpICsgdGhhdC52YWx1ZSAvIHRoYXQub3B0aW9ucy5zdGVwKSAqIHRoYXQub3B0aW9ucy5zdGVwICogMTAwKSAvXG4gICAgICAgICAgMTAwO1xuICAgICAgICBpZiAodGhhdC5vcHRpb25zLnN0ZXAgPCAxKSB7XG4gICAgICAgICAgdGhhdC52YWx1ZSA9IE51bWJlcih0aGF0LnZhbHVlLnRvRml4ZWQoMSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoYXQudmFsdWVBcmMuZW5kQW5nbGUoXG4gICAgICAgICAgdGhhdC52YWx1ZVRvUmFkaWFucyhcbiAgICAgICAgICAgIHRoYXQudmFsdWUsXG4gICAgICAgICAgICB0aGF0Lm9wdGlvbnMubWF4LFxuICAgICAgICAgICAgdGhhdC5vcHRpb25zLmVuZEFuZ2xlLFxuICAgICAgICAgICAgdGhhdC5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgICAgICB0aGF0Lm9wdGlvbnMubWluLFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICAgIHRoYXQudmFsdWVFbGVtLmF0dHIoJ2QnLCB0aGF0LnZhbHVlQXJjKTtcbiAgICAgICAgaWYgKGlzRmluYWwpIHtcbiAgICAgICAgICB0aGF0LmNoYW5nZUFyYy5lbmRBbmdsZShcbiAgICAgICAgICAgIHRoYXQudmFsdWVUb1JhZGlhbnMoXG4gICAgICAgICAgICAgIHRoYXQudmFsdWUsXG4gICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5tYXgsXG4gICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5lbmRBbmdsZSxcbiAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5taW4sXG4gICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhhdC5jaGFuZ2VFbGVtLmF0dHIoJ2QnLCB0aGF0LmNoYW5nZUFyYyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5kaXNwbGF5SW5wdXQpIHtcbiAgICAgICAgICBsZXQgdiA9IHRoYXQubGFiZWwgfHwgdGhhdC52YWx1ZTtcbiAgICAgICAgICBpZiAodHlwZW9mIHRoYXQub3B0aW9ucy5pbnB1dEZvcm1hdHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdiA9IHRoYXQub3B0aW9ucy5pbnB1dEZvcm1hdHRlcih2KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZDMuc2VsZWN0KHRoYXQuZWxlbWVudClcbiAgICAgICAgICAgIC5zZWxlY3QoJyN0ZXh0JylcbiAgICAgICAgICAgIC50ZXh0KHYgKyB0aGF0Lm9wdGlvbnMudW5pdCB8fCAnJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoYXQudmFsdWVDaGFuZ2UuZW1pdCh0aGF0LnZhbHVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogICBTZXQgYSB2YWx1ZVxuICAgKi9cbiAgc2V0VmFsdWUobmV3VmFsdWU6IGFueSkge1xuICAgIGlmICghdGhpcy5pbkRyYWcgJiYgdGhpcy52YWx1ZSA+PSB0aGlzLm9wdGlvbnMubWluICYmIHRoaXMudmFsdWUgPD0gdGhpcy5vcHRpb25zLm1heCkge1xuICAgICAgY29uc3QgcmFkaWFucyA9IHRoaXMudmFsdWVUb1JhZGlhbnMoXG4gICAgICAgIG5ld1ZhbHVlLFxuICAgICAgICB0aGlzLm9wdGlvbnMubWF4LFxuICAgICAgICB0aGlzLm9wdGlvbnMuZW5kQW5nbGUsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlLFxuICAgICAgICB0aGlzLm9wdGlvbnMubWluLFxuICAgICAgKTtcbiAgICAgIHRoaXMudmFsdWUgPVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgICAgICBNYXRoLnJvdW5kKH5+KChuZXdWYWx1ZSA8IDAgPyAtMC41IDogMC41KSArIG5ld1ZhbHVlIC8gdGhpcy5vcHRpb25zLnN0ZXApICogdGhpcy5vcHRpb25zLnN0ZXAgKiAxMDApIC8gMTAwO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGVwIDwgMSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gTnVtYmVyKHRoaXMudmFsdWUudG9GaXhlZCgxKSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNoYW5nZUFyYy5lbmRBbmdsZShyYWRpYW5zKTtcbiAgICAgIGQzLnNlbGVjdCh0aGlzLmVsZW1lbnQpXG4gICAgICAgIC5zZWxlY3QoJyNjaGFuZ2VBcmMnKVxuICAgICAgICAuYXR0cignZCcsIHRoaXMuY2hhbmdlQXJjKTtcbiAgICAgIHRoaXMudmFsdWVBcmMuZW5kQW5nbGUocmFkaWFucyk7XG4gICAgICBkMy5zZWxlY3QodGhpcy5lbGVtZW50KVxuICAgICAgICAuc2VsZWN0KCcjdmFsdWVBcmMnKVxuICAgICAgICAuYXR0cignZCcsIHRoaXMudmFsdWVBcmMpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNwbGF5SW5wdXQpIHtcbiAgICAgICAgbGV0IHYgPSB0aGlzLmxhYmVsIHx8IHRoaXMudmFsdWU7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLmlucHV0Rm9ybWF0dGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgdiA9IHRoaXMub3B0aW9ucy5pbnB1dEZvcm1hdHRlcih2KTtcbiAgICAgICAgfVxuICAgICAgICBkMy5zZWxlY3QodGhpcy5lbGVtZW50KVxuICAgICAgICAgIC5zZWxlY3QoJyN0ZXh0JylcbiAgICAgICAgICAudGV4dCh2ICsgdGhpcy5vcHRpb25zLnVuaXQgfHwgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19